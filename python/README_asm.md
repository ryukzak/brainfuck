# Язык программирования Asm (2024)

> Простая реализация языка asm. Другие детали реализации см. в [./README.md](./README.md).

Синтаксис в расширенной БНФ.

- `[ ... ]` -- вхождение 0 или 1 раз
- `{ ... }` -- повторение 0 или несколько раз
- `{ ... }-` -- повторение 1 или несколько раз

``` ebnf
program ::= { line }

line ::= label [ comment ] "\n"
       | instr [ comment ] "\n"
       | [ comment ] "\n"

label ::= label_name ":"

instr ::= op0
        | op1 label_name

op0 ::= "increment"
      | "decrement"
      | "right"
      | "left"
      | "print"
      | "input"

op1 ::= "jmp"
      | "jz"

integer ::= [ "-" ] { <any of "0-9"> }-

label_name ::= <any of "a-z A-Z _"> { <any of "a-z A-Z 0-9 _"> }

comment ::= ";" <any symbols except "\n">
```

Поддерживаются однострочные комментарии, начинающиеся с `;`.

Операции:

- `increment` -- увеличить значение в текущей ячейке на 1
- `decrement` -- уменьшить значение в текущей ячейке на 1
- `right` -- перейти к следующей ячейке
- `left` -- перейти к предыдущей ячейке
- `print` -- напечатать значение из текущей ячейки (символ)
- `input` -- ввести извне значение и сохранить в текущей ячейке (символ)
- `jmp addr` -- безусловный переход по заданному адресу или метке
- `jz addr` -- условный переход по заданному адресу или метке, если значение текущей ячейки ноль

Метки для переходов определяются на отдельных строчках:

``` asm
label:
    increment
```

И в другом месте (неважно, до или после определения) сослаться на эту метку:

``` asm
jmp label   ; --> `jmp 123`, где 123 - номер инструкции после объявления метки
```

Транслятор поставит на место использования метки адрес той инструкции, перед которой она определена.

В программе не может быть дублирующихся меток, определенных в разных местах с одним именем.

Пример кода на Asm см. в файле [./examples/cat.asm](./examples/cat.asm).

## Транслятор

Интерфейс командной строки: `translator_asm.py <input_file> <target_file>`

Реализован в модуле [translator_asm](./translator_asm.py)

Трансляция реализуется в два прохода:

1. Генерация машинного кода без адресов переходов и расчёт значений меток перехода.
    - Ассемблерные мнемоники один в один транслируются в машинные команды.
2. Подстановка меток перехода в инструкции.

## Тестирование

Тестирование выполняется при помощи golden test-ов.

1. Тесты для языка `asm` реализованы в: [golden_asm_test.py](./golden_asm_test.py). Конфигурации:
    - [golden/cat_asm.yml](golden/cat_asm.yml)
